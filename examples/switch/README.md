# Switch

In this example a switch module is deployed and two virtual network interfaces
in different network namespaces are connected to it.
Connectivity is tested by pinging between the different namespaces

<center><a href="../../images/switch_tutorial.png"><img src="../../images/switch_tutorial.png" width=500></a></center>

## Preparing the network namespaces

In order to work, it is necessary to create two network namespaces and set two
pairs of veth interfaces.

Execute the 'setup.sh' script:

```bash
sudo ./setup.sh
```

## Launching hover

Before deploying the switch, it is necessary to launch the hover daemon.
Please note to kill other instances of hover previously running.

```bash
export GOPATH=$HOME/go
sudo $GOPATH/bin/hoverd -listen 127.0.0.1:5002
```

## Deploying the switch

The `switch.yaml` file contains the  service topology for this example:

```
modules:
  - name: myswitch
    type: switch

external_interfaces:
  - module: myswitch
    iface: veth1
  - module: myswitch
    iface: veth2
```

In the section `modules` it is requested to deploy a switch.
The switch implements a MAC learning algorithm, for that reason it is not necessary
to pass any particular configuration.
Section `external_interfaces` indicates that the switch module should be connected
to `veth1` and `veth2` interfaces.

Then, we are ready to launch it:

```bash
export GOPATH=$HOME/go
cd $GOPATH/src/github.com/netgroup-polito/iovisor-ovn/examples/switch
$GOPATH/bin/iovisorovnd -topologyFile switch.yaml -hover http://127.0.0.1:5002
```

## Testing connectivity

Now you are able to test the connectivity pinging between the network interfaces
in the different network spaces

```bash
sudo ip netns exec ns1 ping 10.0.0.2
```

## Debugging

In order to see the debug output generated by the IOModule we suggest to see the result of the print on the trace_pipe.

```bash
sudo su
cd /sys/kernel/debug/tracing/
cat trace_pipe
```
